bits 32
global start
extern exit,printf,scanf,fread,fopen,fclose,fprintf,fscanf
import exit msvcrt.dll
import printf msvcrt.dll
import scanf msvcrt.dll
import fopen msvcrt.dll
import fclose msvcrt.dll
import fread msvcrt.dll
import fprintf msvcrt.dll
import fscanf msvcrt.dll

segment data use32 class=data

len1 equ 101
text1 times len1 db 0
text2 dd "ana are mere",0
len2 dd $-text2-1
nume_fisier db "1.txt",0
descriptor dd -1
mod_acces db "r",0
mesaj db "nr: ", 0
format db "%d",0
format db "%s",0
nr dd 2

segment code use32 class=code

start:

push dword mesaj
call [printf]
add esp,4*1

push dword [nr]
push dword format
call [scanf]
add esp,4*2

push dword mod_acces
push dword nume_fisier
call [fopen]
add esp,4*2
mov dword [descriptor],eax

cmp eax,0
 je afara
afara
mov ecx,eax

push dword [descriptor]
push dword len1
push dword 1
push dword text1
call [fread]
add esp,4*4



push dword text2
push dword format2
call [scanf]
add esp,4*2

push dword text2
push dword format2
push dword [descriptor]
call [fprintf]
add esp,4*2

push dword [descriptor]
call [fclose]
add esp,4*1

push dword 0
call [exit]
